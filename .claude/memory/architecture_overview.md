# AI Smart Diet Lens - æ¶æ„æ€»è§ˆ (Architecture Overview)

> **æ–‡æ¡£ç±»å‹**: ç³»ç»Ÿæ¶æ„è®¾è®¡
> **ç»´æŠ¤è€…**: Architect
> **æ›´æ–°æ—¥æœŸ**: 2026-02-03
> **çŠ¶æ€**: âœ… å½“å‰æœ‰æ•ˆ

---

## ğŸ“ æ¶æ„åŸåˆ™ (Architecture Principles)

### æ ¸å¿ƒå“²å­¦

```
é€»è¾‘ä¸è§†å›¾åˆ†ç¦» â†’ å¹³å°æ— å…³æ€§ â†’ æµ‹è¯•é©±åŠ¨å¼€å‘ â†’ å¥‘çº¦å¼åä½œ
```

### äº”å¤§æ”¯æŸ±

| æ”¯æŸ± | åŸåˆ™ | æ”¶ç›Š |
|:-----|:-----|:-----|
| **1. æ¥å£å³å›´æ ** | Core å±‚ 100% çº¯ TypeScriptï¼Œé›¶å¹³å° API | è·¨å¹³å°å¤ç”¨ã€å•å…ƒæµ‹è¯•éš”ç¦» |
| **2. Monorepo éš”ç¦»** | Packages é—´é€šè¿‡æ¥å£é€šä¿¡ï¼Œç¦æ­¢ç›´æ¥ä¾èµ–å®ç° | æ¨¡å—ç‹¬ç«‹æ¼”è¿›ã€ä¾èµ–æ¸…æ™° |
| **3. TDD å¼ºåˆ¶å¾ªç¯** | å…ˆå†™æµ‹è¯• â†’ å®ç°é€»è¾‘ â†’ é‡æ„ä¼˜åŒ– | é«˜è´¨é‡ä»£ç ã€å›å½’ä¿æŠ¤ |
| **4. å¥‘çº¦å¼å¼€å‘** | PRD â†’ Design Spec â†’ Ticket â†’ Implementation | éœ€æ±‚å¯è¿½æº¯ã€è´£ä»»æ˜ç¡® |
| **5. é€‚é…å™¨æ³¨å…¥** | å¹³å° API é€šè¿‡ Adapter æ¥å£æŠ½è±¡ | ä¾èµ–åè½¬ã€Mock å‹å¥½ |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ (System Architecture)

### 1ï¸âƒ£ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Smart Diet Lens ç³»ç»Ÿæ¶æ„                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·ç«¯ (Clients)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¾®ä¿¡å°ç¨‹åº  â”‚  H5 ç½‘é¡µç‰ˆ   â”‚   æ”¯ä»˜å®å°ç¨‹åº â”‚   App (æœªæ¥)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ Monorepo (Frontend)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Packages/UI (è§†å›¾å±‚) @diet-lens/ui              â”‚    â”‚
â”‚  â”‚  - Pages (é¡µé¢): é¦–é¡µã€æ‹ç…§ã€æ—¥è®°ã€ç™¾ç§‘ã€ä¸ªäººä¸­å¿ƒ       â”‚    â”‚
â”‚  â”‚  - Components (ç»„ä»¶): FoodCard, CalorieRing, MacroBar  â”‚    â”‚
â”‚  â”‚  - Layouts (å¸ƒå±€): é»˜è®¤å¸ƒå±€ã€æ— å¯¼èˆªå¸ƒå±€                 â”‚    â”‚
â”‚  â”‚  - Adapters Implementation (é€‚é…å™¨å®ç°)                â”‚    â”‚
â”‚  â”‚  - UniApp é¡µé¢é…ç½® (pages.config.ts)                   â”‚    â”‚
â”‚  â”‚  âœ… å¯ä»¥ä½¿ç”¨ uni.xxx API                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â†‘ è°ƒç”¨                              â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚       Packages/Core (ä¸šåŠ¡é€»è¾‘å±‚) @diet-lens/core        â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚  Composables (ä¸šåŠ¡ Hook)                    â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - useAuth: è®¤è¯é€»è¾‘                        â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - useNutrition: è¥å…»è®¡ç®—                   â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - useFoodRecognition: AI è¯†åˆ«              â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - useDiary: æ—¥è®°ç®¡ç†                       â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚  Stores (Pinia çŠ¶æ€ç®¡ç†)                    â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - user.ts: ç”¨æˆ·çŠ¶æ€                        â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - nutrition.ts: è¥å…»æ•°æ®                   â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - diary.ts: æ—¥è®°çŠ¶æ€                       â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚  Adapters (å¹³å°æ¥å£æŠ½è±¡)                    â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - IHttp: HTTP è¯·æ±‚æ¥å£                     â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - IStorage: æœ¬åœ°å­˜å‚¨æ¥å£                   â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - ICamera: ç›¸æœºæ¥å£                        â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚  Types (ç±»å‹å®šä¹‰)                           â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  - user.ts, food.ts, diary.ts, achievement.tsâ”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  âŒ ä¸¥ç¦ uni.xxx, wx.xxx, window.xxx                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åç«¯æœåŠ¡ (Backend)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              NestJS åº”ç”¨å±‚                              â”‚    â”‚
â”‚  â”‚  - Controllers: è·¯ç”±æ§åˆ¶å™¨                             â”‚    â”‚
â”‚  â”‚  - Services: ä¸šåŠ¡æœåŠ¡                                  â”‚    â”‚
â”‚  â”‚  - Guards: æƒé™å®ˆå« (JWT)                              â”‚    â”‚
â”‚  â”‚  - Modules: åŠŸèƒ½æ¨¡å— (auth, food, diary, user)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Prisma ORM å±‚                              â”‚    â”‚
â”‚  â”‚  - Schema: æ•°æ®æ¨¡å‹å®šä¹‰                                â”‚    â”‚
â”‚  â”‚  - Client: æ•°æ®åº“å®¢æˆ·ç«¯                                â”‚    â”‚
â”‚  â”‚  - Migrations: æ•°æ®åº“è¿ç§»                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           PostgreSQL + Redis                            â”‚    â”‚
â”‚  â”‚  - PostgreSQL: ä¸»æ•°æ®åº“                                â”‚    â”‚
â”‚  â”‚  - Redis: ç¼“å­˜ + Session                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“ API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡ (External)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Google Gemini API                          â”‚    â”‚
â”‚  â”‚  - é£Ÿç‰©å›¾åƒè¯†åˆ«                                        â”‚    â”‚
â”‚  â”‚  - è¥å…»æˆåˆ†åˆ†æ                                        â”‚    â”‚
â”‚  â”‚  - AI å¯¹è¯åŠ©æ‰‹                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ Monorepo ç›®å½•ç»“æ„

```
AI-Smart-Diet-Lens/
â”œâ”€â”€ frontend/                         # å‰ç«¯ Monorepo
â”‚   â”œâ”€â”€ packages/
â”‚   â”‚   â”œâ”€â”€ core/                     # @diet-lens/core
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ composables/      # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useNutrition.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useFoodRecognition.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useDiary.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stores/           # Pinia çŠ¶æ€
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ nutrition.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ diary.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/              # API å°è£…
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ food.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ adapters/         # å¹³å°æ¥å£
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IHttp.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ IStorage.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ICamera.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ food.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ diary.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ calculate.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ format.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ tests/                # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ composables/
â”‚   â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â”‚   â””â”€â”€ vitest.config.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ui/                       # @diet-lens/ui
â”‚   â”‚       â”œâ”€â”€ src/
â”‚   â”‚       â”‚   â”œâ”€â”€ pages/            # é¡µé¢ (æ–‡ä»¶è·¯ç”±)
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ index/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ scan/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ diary/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ wiki/
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚       â”‚   â”œâ”€â”€ components/       # UI ç»„ä»¶
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ FoodCard.vue
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ CalorieRing.vue
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ BottomNav.vue
â”‚   â”‚       â”‚   â”œâ”€â”€ layouts/          # å¸ƒå±€
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ default.vue
â”‚   â”‚       â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”‚       â””â”€â”€ adapters.ts   # é€‚é…å™¨å®ç°
â”‚   â”‚       â”œâ”€â”€ pages.config.ts       # é¡µé¢é…ç½®
â”‚   â”‚       â”œâ”€â”€ manifest.config.ts    # åº”ç”¨é…ç½®
â”‚   â”‚       â”œâ”€â”€ uno.config.ts         # UnoCSS é…ç½®
â”‚   â”‚       â”œâ”€â”€ vite.config.ts
â”‚   â”‚       â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ pnpm-workspace.yaml
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                          # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/                 # è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ user/                 # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ food/                 # é£Ÿç‰©æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ diary/                # æ—¥è®°æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ common/                   # å…¬å…±æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”‚   â””â”€â”€ filters/
â”‚   â”‚   â””â”€â”€ prisma/
â”‚   â”‚       â””â”€â”€ schema.prisma
â”‚   â”œâ”€â”€ test/
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ .claude/                          # AI åä½œç³»ç»Ÿ
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ rules/
â”‚   â”œâ”€â”€ skills/
â”‚   â””â”€â”€ tickets/
â”‚
â””â”€â”€ diet-lens.code-workspace         # VS Code å·¥ä½œåŒº
```

---

## ğŸ‘¥ è§’è‰²ä¸èŒè´£ (Roles & Responsibilities)

### è§’è‰²çŸ©é˜µ

| è§’è‰² | èŒè´£ | æ–‡ä»¶æƒé™ | å·¥å…· |
|:-----|:-----|:---------|:-----|
| **Architect** | æ¶æ„è®¾è®¡ã€å¥‘çº¦åˆ¶å®šã€è®°å¿†ç®¡ç† | RW: `.claude/` | `/prd`, `/ui`, `/plan` |
| **Frontend Builder** | å‰ç«¯å¼€å‘ã€Core å±‚ TDDã€UI å®ç° | RW: `frontend/` | `/dev` |
| **Backend Builder** | åç«¯å¼€å‘ã€API å®ç°ã€æ•°æ®åº“è®¾è®¡ | RW: `backend/` | `/dev` |

### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¼€å‘å·¥ä½œæµ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Architect åˆ¶å®š PRD/Design Spec
    â†“
Architect åˆ›å»º Tickets (åˆ†é…ç»™ Frontend/Backend Builder)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Frontend Builder        â”‚      Backend Builder        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç¼–å†™ Core å±‚æµ‹è¯•         â”‚ 1. ç¼–å†™åç«¯æµ‹è¯•             â”‚
â”‚ 2. å®ç° Core å±‚é€»è¾‘         â”‚ 2. å®ç° Controller/Service  â”‚
â”‚ 3. åˆ›å»º/ä¿®æ”¹ UI ç»„ä»¶        â”‚ 3. å®ç° Prisma Schema       â”‚
â”‚ 4. é›†æˆ @diet-lens/core     â”‚ 4. è¿è¡Œæ•°æ®åº“è¿ç§»           â”‚
â”‚ 5. æäº¤ PR (scope: ui/core) â”‚ 5. æäº¤ PR (scope: backend) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Architect Code Review
    â†“
é€šè¿‡ â†’ åˆå¹¶åˆ°ä¸»åˆ†æ”¯
æœªé€šè¿‡ â†’ ä¿®æ”¹åé‡æ–°æäº¤
```

---

## ğŸ”„ æ ¸å¿ƒæ•°æ®æµ (Data Flow)

### AI é£Ÿç‰©è¯†åˆ«æµç¨‹

```
ç”¨æˆ·æ“ä½œ (UI Layer - Scan Page)
    â†“
ç‚¹å‡»æ‹ç…§æŒ‰é’®
    â†“
è°ƒç”¨ useFoodRecognition(http, camera).recognize()  â† Composable (Core)
    â†“
camera.takePicture()                               â† Adapter Interface
    â†“
[è·¨è¶Šè¾¹ç•Œ - é€‚é…å™¨å®ç°åœ¨ UI Layer]
    â†“
uni.chooseImage({ sourceType: ['camera'] })        â† UniApp API (UI)
    â†“
http.request({ url: '/api/food/recognize' })       â† Adapter Interface
    â†“
HTTP POST to Backend                               â†’ Backend API
    â†“
FoodController.recognize()                         â† NestJS Controller
    â†“
FoodService.recognizeWithGemini()                  â† Business Logic
    â†“
Gemini API Call                                    â†’ External API
    â†“
Response: { food, confidence, nutrition }          â† API Response
    â†“
nutritionStore.setCurrentFood(result)              â† æ›´æ–°çŠ¶æ€
    â†“
router.push('/result')                             â† å¯¼èˆªåˆ°ç»“æœé¡µ
    â†“
FoodResult.vue å“åº”å¼æ›´æ–°                           â† Vue å“åº”å¼ç³»ç»Ÿ
```

### é¥®é£Ÿæ—¥è®°è®°å½•æµç¨‹

```
ç”¨æˆ·æ“ä½œ (FoodResult Page)
    â†“
ç‚¹å‡» "è®°å½•åˆ°æ—¥è®°"
    â†“
useDiary(http).addEntry(foodItem, meal)            â† Composable (Core)
    â†“
http.request({ url: '/api/diary', method: 'POST'}) â† Adapter Interface
    â†“
HTTP POST to Backend                               â†’ Backend API
    â†“
DiaryController.create()                           â† NestJS
    â†“
DiaryService.create() + prisma.diary.create()      â† DB Write
    â†“
diaryStore.addEntry(result)                        â† æ›´æ–°å‰ç«¯çŠ¶æ€
    â†“
Diary.vue è‡ªåŠ¨æ›´æ–°æ˜¾ç¤º                              â† Vue å“åº”å¼
```

---

## ğŸ”’ æ¥å£å›´æ è§„åˆ™ (Interface Fence Rule)

### è§„åˆ™å®šä¹‰

**Core å±‚ç¦æ­¢åŒº (Forbidden Zone)**:

```typescript
// âŒ ä»¥ä¸‹ä»£ç åœ¨ packages/core/src/ ä¸­ç»å¯¹ç¦æ­¢

// 1. UniApp API
uni.request()
uni.getStorage()
uni.navigateTo()
uni.chooseImage()

// 2. å¾®ä¿¡å°ç¨‹åº API
wx.login()
wx.getUserInfo()

// 3. æµè§ˆå™¨ API
window.location
navigator.geolocation
document.querySelector()
localStorage.setItem()

// 4. ä»»ä½•å¹³å°ç‰¹å®š API
my.xxx  // æ”¯ä»˜å®
swan.xxx  // ç™¾åº¦
tt.xxx  // å­—èŠ‚è·³åŠ¨
```

### æ­£ç¡®å®è·µ

**åœ¨ Core å±‚å®šä¹‰æ¥å£**:

```typescript
// packages/core/src/adapters/ICamera.ts
export interface ICamera {
  takePicture(): Promise<string>  // è¿”å›å›¾ç‰‡è·¯å¾„æˆ– base64
  chooseFromAlbum(): Promise<string>
}

// packages/core/src/composables/useFoodRecognition.ts
import type { IHttp } from '@/adapters/IHttp'
import type { ICamera } from '@/adapters/ICamera'

export function useFoodRecognition(http: IHttp, camera: ICamera) {
  const recognize = async () => {
    const imagePath = await camera.takePicture()
    const result = await http.request({
      url: '/api/food/recognize',
      method: 'POST',
      data: { image: imagePath }
    })
    return result.data
  }

  return { recognize }
}
```

**åœ¨ UI å±‚å®ç°é€‚é…å™¨**:

```typescript
// packages/ui/src/utils/adapters.ts
import type { ICamera } from '@diet-lens/core/adapters/ICamera'

export const cameraAdapter: ICamera = {
  takePicture: async () => {
    const [error, res] = await uni.chooseImage({
      count: 1,
      sourceType: ['camera'],
    })
    if (error) throw error
    return res.tempFilePaths[0]
  },

  chooseFromAlbum: async () => {
    const [error, res] = await uni.chooseImage({
      count: 1,
      sourceType: ['album'],
    })
    if (error) throw error
    return res.tempFilePaths[0]
  }
}
```

---

## ğŸ“¦ æŠ€æœ¯æ ˆè¯¦ç»†æ¸…å• (Tech Stack Details)

### å‰ç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|:-----|:-----|:-----|:-----|
| **è·¨ç«¯æ¡†æ¶** | UniApp | 3.0+ | å¤šç«¯ç»Ÿä¸€ |
| **å‰ç«¯æ¡†æ¶** | Vue 3 | ^3.4.0 | Composition API |
| **è¯­è¨€** | TypeScript | ~5.8.0 | ç±»å‹å®‰å…¨ |
| **æ„å»º** | Vite | 6.x | æ„å»ºå·¥å…· |
| **çŠ¶æ€** | Pinia | ^2.1.0 | çŠ¶æ€ç®¡ç† |
| **æ ·å¼** | UnoCSS | latest | åŸå­åŒ– CSS |
| **UI åº“** | Wot Design Uni | latest | ç»„ä»¶åº“ |
| **æµ‹è¯•** | Vitest | latest | å•å…ƒæµ‹è¯• |
| **å·¥å…·** | @vueuse/core | latest | ç»„åˆå¼å·¥å…· |

### åç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|:-----|:-----|:-----|:-----|
| **è¿è¡Œæ—¶** | Node.js | 20.x LTS | æœåŠ¡å™¨ç¯å¢ƒ |
| **æ¡†æ¶** | NestJS | 11.x | Web æ¡†æ¶ |
| **è¯­è¨€** | TypeScript | ~5.8.0 | ç±»å‹å®‰å…¨ |
| **ORM** | Prisma | 5.x+ | æ•°æ®åº“ ORM |
| **æ•°æ®åº“** | PostgreSQL | 16+ | ä¸»æ•°æ®åº“ |
| **ç¼“å­˜** | Redis | 7+ | ç¼“å­˜ |
| **è®¤è¯** | Passport + JWT | - | èº«ä»½è®¤è¯ |
| **æµ‹è¯•** | Jest | 30+ | å•å…ƒæµ‹è¯• |

### å¼€å‘å·¥å…·é“¾

| ç±»åˆ« | å·¥å…· | ç”¨é€” |
|:-----|:-----|:-----|
| **åŒ…ç®¡ç†** | pnpm | Workspaces |
| **ä»£ç è´¨é‡** | ESLint + Prettier | ä»£ç è§„èŒƒ |
| **æäº¤è§„èŒƒ** | Commitlint + Husky | Git Hooks |
| **IDE** | VS Code | å¤šå·¥ä½œåŒº |

---

## ğŸ“ Builder ä»»åŠ¡æ¸…å• (Builder Task List)

### Frontend Builder ä»»åŠ¡

| ä»»åŠ¡ ID | ä»»åŠ¡æè¿° | ä¼˜å…ˆçº§ | ä¾èµ– |
|:--------|:--------|:-------|:-----|
| **FE-001** | åˆå§‹åŒ– Monorepo ç»“æ„ (vitesse-uni-app) | P0 | - |
| **FE-002** | åˆ›å»º types/ æ ¸å¿ƒç±»å‹å®šä¹‰ | P0 | FE-001 |
| **FE-003** | åˆ›å»ºé€‚é…å™¨æ¥å£ (IHttp, IStorage, ICamera) | P0 | FE-002 |
| **FE-004** | å®ç° userStore | P0 | FE-002 |
| **FE-005** | å®ç° useAuth composable + æµ‹è¯• | P1 | FE-003, FE-004 |
| **FE-006** | å®ç° nutritionStore | P1 | FE-002 |
| **FE-007** | å®ç° useNutrition composable + æµ‹è¯• | P1 | FE-006 |
| **FE-008** | è¿ç§»ç°æœ‰é¡µé¢åˆ° UI åŒ… | P1 | FE-001 |
| **FE-009** | å®ç°é€‚é…å™¨ (httpAdapter, storageAdapter) | P1 | FE-003 |
| **FE-010** | é›†æˆ Core å±‚åˆ° UI é¡µé¢ | P2 | FE-008, FE-009 |

### Backend Builder ä»»åŠ¡

| ä»»åŠ¡ ID | ä»»åŠ¡æè¿° | ä¼˜å…ˆçº§ | ä¾èµ– |
|:--------|:--------|:-------|:-----|
| **BE-001** | åˆå§‹åŒ– NestJS é¡¹ç›®ç»“æ„ | P0 | - |
| **BE-002** | é…ç½® Prisma + PostgreSQL | P0 | BE-001 |
| **BE-003** | è®¾è®¡ç”¨æˆ· Schema + è¿ç§» | P0 | BE-002 |
| **BE-004** | å®ç° Auth æ¨¡å— (ç™»å½•/æ³¨å†Œ) | P1 | BE-003 |
| **BE-005** | è®¾è®¡é£Ÿç‰©/è¥å…» Schema | P1 | BE-002 |
| **BE-006** | å®ç° Food æ¨¡å— (Gemini é›†æˆ) | P1 | BE-005 |
| **BE-007** | è®¾è®¡æ—¥è®° Schema | P1 | BE-003, BE-005 |
| **BE-008** | å®ç° Diary æ¨¡å— (CRUD) | P2 | BE-007 |
| **BE-009** | æ·»åŠ  JWT è®¤è¯å®ˆå« | P1 | BE-004 |
| **BE-010** | é›†æˆæµ‹è¯• | P2 | BE-004, BE-006, BE-008 |

### ä»»åŠ¡ä¾èµ–å…³ç³»

```
Frontend:
FE-001 â†’ FE-002 â†’ FE-003 â†’ FE-005 â†’ FE-009 â†’ FE-010
              â†“         â†“
           FE-004    FE-006 â†’ FE-007
              â†“
           FE-008

Backend:
BE-001 â†’ BE-002 â†’ BE-003 â†’ BE-004 â†’ BE-009
              â†“         â†“
           BE-005 â†’ BE-006
              â†“
           BE-007 â†’ BE-008 â†’ BE-010
```

---

## ğŸ“ å¼€å‘è€…æŒ‡å— (Developer Guide)

### VS Code å·¥ä½œåŒºä½¿ç”¨

```bash
# æ‰“å¼€å¤šå·¥ä½œåŒº
code diet-lens.code-workspace
```

å·¥ä½œåŒºåŒ…å«ï¼š
- ğŸ¨ **Frontend - Core**: `frontend/packages/core`
- ğŸ¨ **Frontend - UI**: `frontend/packages/ui`
- âš™ï¸ **Backend**: `backend`
- ğŸ“ **Claude AI**: `.claude`

### å¸¸ç”¨å‘½ä»¤

```bash
# å‰ç«¯å¼€å‘
pnpm --filter @diet-lens/ui dev:h5
pnpm --filter @diet-lens/core test:watch

# åç«¯å¼€å‘
pnpm --filter backend start:dev
pnpm --filter backend prisma:studio

# å…¨æ ˆåŒæ—¶å¯åŠ¨
pnpm dev:all
```

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Architect
**æœ€åæ›´æ–°**: 2026-02-03
**ä¸‹æ¬¡å®¡æŸ¥**: 2026-03-03

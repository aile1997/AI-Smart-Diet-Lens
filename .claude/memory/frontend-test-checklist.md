# AI Smart Diet Lens - 前端测试清单

> **项目**: AI Smart Diet Lens (UniApp + Vue 3 + TypeScript)
> **测试框架**: Vitest + @vue/test-utils
> **最后更新**: 2026-02-06

---

## 一、单元测试清单 (Unit Tests)

> **目标**: 测试纯函数和工具类，不依赖 Vue 组件和平台 API
> **位置**: `frontend/packages/core/tests/`

### 1.1 工具函数测试 (Utils)

| 文件 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **calculate.ts** | BMR 计算 (男性/女性) | P0 | ✅ |
| | TDEE 计算 (各活动等级) | P0 | ✅ |
| | 热量目标计算 (减脂/维持/增肌) | P0 | ✅ |
| | 营养素百分比计算 | P0 | ⬜ |
| | BMI 计算 | P1 | ⬜ |
| **format.ts** | 卡路里格式化 | P1 | ⬜ |
| | 体重格式化 | P1 | ⬜ |
| | 日期格式化 | P1 | ⬜ |
| | 时间格式化 | P1 | ⬜ |
| **sanitize.ts** | HTML 标签白名单过滤 | P0 | ⬜ |
| | 移除危险协议 (javascript:, data:) | P0 | ⬜ |
| | 移除事件处理属性 | P0 | ⬜ |
| | 空值处理 | P1 | ⬜ |
| **secure-storage.ts** | Token 加密/解密 | P0 | ⬜ |
| | 加密密钥轮换 | P1 | ⬜ |
| | 异常数据处理 | P1 | ⬜ |
| **validation.ts** | 邮箱格式验证 | P0 | ⬜ |
| | 手机号验证 (中国大陆) | P0 | ⬜ |
| | 验证码验证 (6位数字) | P0 | ⬜ |
| | 密码强度验证 | P1 | ⬜ |
| | 边界值测试 | P1 | ⬜ |
| **throttle.ts** | 防抖函数 | P1 | ⬜ |
| | 节流函数 | P1 | ⬜ |
| | 限流器 (Rate Limiter) | P0 | ⬜ |
| | 冷却时间计算 | P1 | ⬜ |
| **error-handler.ts** | AppError 类构造 | P1 | ⬜ |
| | getUserMessage 错误映射 | P0 | ⬜ |
| | 错误日志记录 | P1 | ⬜ |
| | withRetry 重试逻辑 | P0 | ⬜ |
| | 可重试错误判断 | P1 | ⬜ |
| **logger.ts** | 日志级别过滤 | P1 | ⬜ |
| | 环境变量读取 | P1 | ⬜ |
| | 格式化输出 | P2 | ⬜ |

### 1.2 API 客户端测试

| 文件 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **client.ts** | GET 请求 | P0 | ⬜ |
| | POST 请求 | P0 | ⬜ |
| | PUT/PATCH 请求 | P0 | ⬜ |
| | DELETE 请求 | P0 | ⬜ |
| | Token 注入 | P0 | ⬜ |
| | 请求超时处理 | P1 | ⬜ |
| | 错误响应处理 | P1 | ⬜ |
| | 网络错误处理 | P1 | ⬜ |
| **auth.service.ts** | 发送验证码 | P0 | ⬜ |
| | 邮箱验证码登录 | P0 | ⬜ |
| | 微信授权登录 | P1 | ⬜ |
| **dashboard.service.ts** | 获取仪表盘数据 | P0 | ⬜ |
| **diary.service.ts** | CRUD 操作 | P0 | ⬜ |
| **food.service.ts** | 搜索食物 | P0 | ⬜ |
| | 条形码查询 | P1 | ⬜ |
| **nutrition.service.ts** | 获取营养趋势 | P0 | ⬜ |
| **notifications.service.ts** | 获取消息列表 | P0 | ⬜ |
| | 标记已读 | P0 | ⬜ |
| **community.service.ts** | 帖子 CRUD | P0 | ⬜ |
| | 点赞/取消点赞 | P0 | ⬜ |
| | 评论 CRUD | P0 | ⬜ |
| **favorites.service.ts** | 添加/删除收藏 | P0 | ⬜ |
| | 获取收藏列表 | P0 | ⬜ |

---

## 二、Composables 测试清单

> **目标**: 测试组合式函数的逻辑，需要 Mock Store 和 API
> **位置**: `frontend/packages/core/tests/composables/`

### 2.1 核心业务逻辑

| 文件 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **useAuth.ts** | initAuth 从存储恢复 Token | P0 | ⬜ |
| | sendCode 限流逻辑 | P0 | ⬜ |
| | sendCode 冷却时间计算 | P0 | ⬜ |
| | loginWithEmail 成功 | P0 | ⬜ |
| | loginWithEmail 失败 | P0 | ⬜ |
| | logout 清除状态 | P0 | ⬜ |
| **useUser.ts** | 获取用户信息 | P0 | ⬜ |
| | 更新用户资料 | P0 | ⬜ |
| | 更新健康指标 | P0 | ⬜ |
| **useDashboard.ts** | 加载仪表盘数据 | P0 | ⬜ |
| | 热量趋势计算 | P0 | ⬜ |
| | 营养分布计算 | P0 | ⬜ |
| **useDiary.ts** | 获取日记列表 | P0 | ⬜ |
| | 添加日记条目 | P0 | ⬜ |
| | 更新日记条目 | P0 | ⬜ |
| | 删除日记条目 | P0 | ⬜ |
| | 日期筛选 | P1 | ⬜ |
| **useFood.ts** | 搜索食物 | P0 | ⬜ |
| | 扫描条形码 | P1 | ⬜ |
| | 获取食物详情 | P0 | ⬜ |
| **useAnalysis.ts** | 获取营养趋势数据 | P0 | ⬜ |
| | 营养素分布统计 | P0 | ⬜ |
| | 目标达成率计算 | P1 | ⬜ |
| **useNotifications.ts** | 获取消息列表 | P0 | ⬜ |
| | 标记已读 | P0 | ⬜ |
| | 批量已读 | P1 | ⬜ |
| | 删除消息 | P1 | ⬜ |
| **useCommunity.ts** | 获取帖子列表 | P0 | ⬜ |
| | 创建帖子 | P0 | ⬜ |
| | 点赞/取消点赞 | P0 | ⬜ |
| | 评论操作 | P0 | ⬜ |
| | 删除帖子/评论 | P0 | ⬜ |
| **useFavorites.ts** | 添加收藏 | P0 | ⬜ |
| | 移除收藏 | P0 | ⬜ |
| | 获取收藏列表 | P0 | ⬜ |
| | 收藏状态检查 | P1 | ⬜ |
| **useGamification.ts** | 获取成就列表 | P0 | ⬜ |
| | 获取用户进度 | P0 | ⬜ |
| | 解锁成就 | P1 | ⬜ |
| **useChat.ts** | 发送消息 | P0 | ⬜ |
| | 获取对话历史 | P0 | ⬜ |
| | 清空对话 | P1 | ⬜ |
| **useRouteGuard.ts** | isProtectedRoute 判断 | P0 | ⬜ |
| | setupRouteGuard 拦截 | P0 | ⬜ |
| | navigateTo 拦截 | P0 | ⬜ |
| | redirectTo 拦截 | P0 | ⬜ |
| | switchTab 拦截 | P0 | ⬜ |

---

## 三、Store 测试清单

> **目标**: 测试 Pinia Store 的状态管理和持久化
> **位置**: `frontend/packages/core/tests/stores/`

### 3.1 状态管理

| 文件 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **auth.ts** | 初始状态 | P0 | ⬜ |
| | isLoggedIn 计算属性 | P0 | ⬜ |
| | Token 状态持久化 | P0 | ⬜ |
| | 发送验证码状态变化 | P0 | ⬜ |
| | 登录后状态更新 | P0 | ⬜ |
| | 登出后状态清除 | P0 | ⬜ |
| **user.ts** | 用户信息状态 | P0 | ⬜ |
| | 健康指标状态 | P0 | ⬜ |
| | 状态持久化 | P1 | ⬜ |
| **nutrition.ts** | 营养目标状态 | P0 | ⬜ |
| | 今日摄入状态 | P0 | ⬜ |
| **diary.ts** | 日记条目状态 | P0 | ⬜ |
| | 选中日期状态 | P1 | ⬜ |
| **community.ts** | 帖子列表状态 | P0 | ⬜ |
| | 点赞状态缓存 | P1 | ⬜ |

---

## 四、组件测试清单 (Component Tests)

> **目标**: 测试 UI 组件的渲染和交互
> **位置**: `frontend/packages/ui/tests/components/`
> **环境**: jsdom (需配置)

### 4.1 通用组件

| 组件 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **Loading.vue** | spinner 类型渲染 | P1 | ⬜ |
| | dots 类型渲染 | P1 | ⬜ |
| | pulse 类型渲染 | P1 | ⬜ |
| | 不同尺寸显示 | P2 | ⬜ |
| | 自定义颜色 | P2 | ⬜ |
| **Skeleton.vue** | card 类型渲染 | P1 | ⬜ |
| | list 类型渲染 | P1 | ⬜ |
| | avatar 类型渲染 | P1 | ⬜ |
| | text 类型渲染 | P1 | ⬜ |
| | 自定义行数 | P2 | ⬜ |
| **EmptyState.vue** | default 类型显示 | P1 | ⬜ |
| | network 类型显示 | P1 | ⬜ |
| | no-search 类型显示 | P1 | ⬜ |
| | error 类型显示 | P1 | ⬜ |
| | 自定义图标和文字 | P2 | ⬜ |
| | action 按钮点击 | P1 | ⬜ |
| **BottomNav.vue** | 渲染导航项 | P1 | ⬜ |
| | 选中状态切换 | P0 | ⬜ |
| | 图标显示 | P1 | ⬜ |
| | 路由跳转 | P0 | ⬜ |
| **FoodCard.vue** | 渲染食物信息 | P1 | ⬜ |
| | 点击事件触发 | P0 | ⬜ |
| | 收藏按钮 | P0 | ⬜ |
| **DiaryCard.vue** | 渲染日记条目 | P1 | ⬜ |
| | 编辑/删除按钮 | P0 | ⬜ |
| **PostCard.vue** | 渲染帖子内容 | P1 | ⬜ |
| | 点赞交互 | P0 | ⬜ |
| | 评论展开 | P1 | ⬜ |
| **ChatMessage.vue** | 渲染消息 | P1 | ⬜ |
| | XSS 防护验证 | P0 | ⬜ |
| | 富文本显示 | P1 | ⬜ |

### 4.2 页面组件 (关键页面)

| 页面 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **login.vue** | 邮箱输入验证 | P0 | ⬜ |
| | 验证码输入验证 | P0 | ⬜ |
| | 发送验证码倒计时 | P0 | ⬜ |
| | 登录成功跳转 | P0 | ⬜ |
| | 登录失败提示 | P0 | ⬜ |
| | 限流状态显示 | P0 | ⬜ |
| **register.vue** | 表单验证 | P0 | ⬜ |
| | 步骤切换 | P1 | ⬜ |
| | 注册成功 | P0 | ⬜ |
| **index.vue** | 仪表盘数据加载 | P0 | ⬜ |
| | 热量卡片显示 | P0 | ⬜ |
| | 营养环形图 | P1 | ⬜ |
| | 未登录状态 | P0 | ⬜ |
| **analysis/index.vue** | 趋势图加载 | P0 | ⬜ |
| | 时间范围切换 | P1 | ⬜ |
| | 营养分布图 | P1 | ⬜ |
| **messages/index.vue** | 消息列表加载 | P0 | ⬜ |
| | 已读/未读状态 | P0 | ⬜ |
| | 标记已读 | P0 | ⬜ |
| | 空状态显示 | P1 | ⬜ |
| **profile/index.vue** | 用户信息显示 | P0 | ⬜ |
| | 健康指标显示 | P0 | ⬜ |
| | 编辑功能 | P0 | ⬜ |
| | 登出功能 | P0 | ⬜ |
| **diary/index.vue** | 日记列表加载 | P0 | ⬜ |
| | 日期切换 | P0 | ⬜ |
| | 添加日记 | P0 | ⬜ |
| | 编辑/删除 | P0 | ⬜ |
| | 总计显示 | P1 | ⬜ |
| **ai-chat/index.vue** | 发送消息 | P0 | ⬜ |
| | 响应显示 | P0 | ⬜ |
| | 清空对话 | P1 | ⬜ |
| | XSS 防护 | P0 | ⬜ |

---

## 五、集成测试清单 (Integration Tests)

> **目标**: 测试多个模块协作，使用真实 API 或 Mock Server
> **位置**: `frontend/packages/core/tests/integration/`

| 场景 | 测试项 | 优先级 | 状态 |
|:-----|:-------|:-------|:-----|
| **认证流程** | 完整登录流程 (发送验证码 → 验证登录) | P0 | ⬜ |
| | Token 持久化 → 重启恢复 | P0 | ⬜ |
| | 登出 → 清除状态 | P0 | ⬜ |
| | 路由守卫拦截 | P0 | ⬜ |
| **用户流程** | 首次注册 (目标设置 → 身体指标 → 完成) | P0 | ⬜ |
| | 更新个人资料 | P1 | ⬜ |
| | 更新健康指标 | P1 | ⬜ |
| **饮食记录流程** | 搜索食物 → 添加到日记 | P0 | ⬜ |
| | 编辑日记条目 | P0 | ⬜ |
| | 删除日记条目 | P0 | ⬜ |
| | 查看历史记录 | P1 | ⬜ |
| **分析流程** | 查看仪表盘 | P0 | ⬜ |
| | 查看营养趋势 | P0 | ⬜ |
| | 切换时间范围 | P1 | ⬜ |
| **社区流程** | 浏览帖子列表 | P0 | ⬜ |
| | 发布帖子 | P0 | ⬜ |
| | 点赞帖子 | P0 | ⬜ |
| | 评论帖子 | P0 | ⬜ |
| | 删除帖子 | P1 | ⬜ |
| **收藏流程** | 添加收藏 | P0 | ⬜ |
| | 移除收藏 | P0 | ⬜ |
| | 查看收藏列表 | P0 | ⬜ |
| **消息流程** | 获取消息列表 | P0 | ⬜ |
| | 标记已读 | P0 | ⬜ |
| | 删除消息 | P1 | ⬜ |
| **AI 对话流程** | 发送消息 → 接收响应 | P0 | ⬜ |
| | 查看历史对话 | P1 | ⬜ |
| | 清空对话 | P1 | ⬜ |

---

## 六、E2E 测试清单 (End-to-End Tests)

> **目标**: 真实环境完整流程测试
> **框架**: Playwright / Puppeteer
> **位置**: `frontend/e2e/`

| 场景 | 测试步骤 | 优先级 | 状态 |
|:-----|:---------|:-------|:-----|
| **新用户注册** | 1. 打开应用<br>2. 点击注册<br>3. 填写邮箱<br>4. 设置目标<br>5. 填写身体指标<br>6. 完成注册<br>7. 进入首页 | P0 | ⬜ |
| **登录流程** | 1. 打开登录页<br>2. 输入邮箱<br>3. 获取验证码<br>4. 输入验证码<br>5. 登录成功<br>6. 跳转首页 | P0 | ⬜ |
| **记录饮食** | 1. 登录<br>2. 进入饮食日记<br>3. 点击添加<br>4. 搜索食物<br>5. 选择食物<br>6. 设置份量<br>7. 保存<br>8. 验证显示 | P0 | ⬜ |
| **查看分析** | 1. 登录<br>2. 进入分析页<br>3. 验证热量趋势图<br>4. 验证营养分布图<br>5. 切换时间范围 | P0 | ⬜ |
| **社区互动** | 1. 登录<br>2. 进入社区<br>3. 浏览帖子<br>4. 点赞帖子<br>5. 发表评论<br>6. 验证互动 | P0 | ⬜ |
| **发布帖子** | 1. 登录<br>2. 进入社区<br>3. 点击发布<br>4. 输入内容<br>5. 发布<br>6. 验证显示 | P1 | ⬜ |
| **收藏功能** | 1. 登录<br>2. 浏览食物<br>3. 点击收藏<br>4. 进入收藏页<br>5. 验证显示 | P1 | ⬜ |
| **消息中心** | 1. 登录<br>2. 进入消息页<br>3. 查看消息列表<br>4. 点击消息<br>5. 标记已读<br>6. 验证状态 | P1 | ⬜ |
| **个人资料** | 1. 登录<br>2. 进入个人页<br>3. 点击编辑<br>4. 修改资料<br>5. 保存<br>6. 验证更新 | P1 | ⬜ |
| **设置页** | 1. 登录<br>2. 进入设置页<br>3. 修改设置<br>4. 保存<br>5. 验证 | P2 | ⬜ |
| **登出** | 1. 登录<br>2. 进入设置页<br>3. 点击登出<br>4. 验证清除状态<br>5. 返回登录页 | P0 | ⬜ |

---

## 七、安全测试清单

| 测试项 | 描述 | 优先级 | 状态 |
|:-----|:-----|:-------|:-----|
| **XSS 防护** | AI 聊天富文本注入攻击 | P0 | ⬜ |
| | 帖子内容注入攻击 | P0 | ⬜ |
| | 评论内容注入攻击 | P0 | ⬜ |
| **Token 安全** | Token 加密存储验证 | P0 | ⬜ |
| | Token 过期处理 | P0 | ⬜ |
| | 登出后清除 Token | P0 | ⬜ |
| **输入验证** | 邮箱格式验证 (无效输入) | P0 | ⬜ |
| | 手机号验证 (无效输入) | P0 | ⬜ |
| | 验证码验证 (非数字) | P0 | ⬜ |
| **API 滥用** | 验证码发送限流 | P0 | ⬜ |
| | 登录请求限流 | P0 | ⬜ |
| | 搜索请求限流 | P1 | ⬜ |
| **路由安全** | 未登录访问保护页面 | P0 | ⬜ |
| | Token 过期后跳转 | P0 | ⬜ |

---

## 八、性能测试清单

| 测试项 | 描述 | 目标 | 状态 |
|:-----|:-----|:-----|:-----|
| **首屏加载** | 首页完全加载时间 | < 2s | ⬜ |
| **API 响应** | 各 API 接口响应时间 | < 500ms | ⬜ |
| **列表渲染** | 100 条日记列表渲染 | < 500ms | ⬜ |
| **图片加载** | 图片懒加载验证 | 不阻塞 | ⬜ |
| **内存泄漏** | 长时间使用内存稳定性 | 无增长 | ⬜ |
| **Bundle 大小** | 打包体积分析 | < 500KB | ⬜ |

---

## 九、兼容性测试清单

| 平台 | 版本 | 测试项 | 状态 |
|:-----|:-----|:-------|:-----|
| **微信小程序** | 基础库 2.x+ | 完整功能测试 | ⬜ |
| **H5** | Chrome 最新版 | 完整功能测试 | ⬜ |
| | Safari 最新版 | 完整功能测试 | ⬜ |
| | Firefox 最新版 | 完整功能测试 | ⬜ |
| | Edge 最新版 | 完整功能测试 | ⬜ |
| | iOS Safari | 完整功能测试 | ⬜ |
| | Android Chrome | 完整功能测试 | ⬜ |

---

## 十、测试执行命令

### 单元测试

```bash
# 运行所有测试
pnpm --filter @diet-lens/core test

# 监听模式
pnpm --filter @diet-lens/core test:watch

# 覆盖率报告
pnpm --filter @diet-lens/core test:coverage

# 运行特定测试文件
pnpm --filter @diet-lens/core test -- sanitize
```

### 组件测试

```bash
# 需先配置 jsdom 环境
# TODO: 添加组件测试配置
```

### E2E 测试

```bash
# 需先配置 E2E 测试框架
# TODO: 添加 E2E 测试配置
```

---

## 十一、测试覆盖率目标

| 模块 | 目标覆盖率 | 当前 | 状态 |
|:-----|:----------|:-----|:-----|
| **Utils** | 90% | ~30% | ⬜ |
| **API Services** | 80% | 0% | ⬜ |
| **Composables** | 80% | 10% | ⬜ |
| **Stores** | 80% | 0% | ⬜ |
| **Components** | 60% | 0% | ⬜ |
| **总体** | 75% | ~10% | ⬜ |

---

**最后更新**: 2026-02-06
**维护者**: Frontend Builder

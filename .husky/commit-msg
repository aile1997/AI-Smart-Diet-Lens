#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ“ æ£€æŸ¥æäº¤æ¶ˆæ¯æ ¼å¼..."

# è¯»å–æäº¤æ¶ˆæ¯æ–‡ä»¶å†…å®¹
commit_msg=$(cat "$1")

# æäº¤æ¶ˆæ¯æ ¼å¼æ£€æŸ¥
# å…è®¸çš„æ ¼å¼:
# - feat: ç®€çŸ­æè¿°
# - fix: ç®€çŸ­æè¿°
# - docs: ç®€çŸ­æè¿°
# - test: ç®€çŸ­æè¿°
# - chore: ç®€çŸ­æè¿°
# - refactor: ç®€çŸ­æè¿°

# å…è®¸åˆå¹¶æäº¤
if echo "$commit_msg" | grep -qE "^Merge branch"; then
  echo "âœ… åˆå¹¶æäº¤ï¼Œè·³è¿‡æ£€æŸ¥"
  exit 0
fi

# å…è®¸å›é€€æäº¤
if echo "$commit_msg" | grep -qE "^Revert"; then
  echo "âœ… å›é€€æäº¤ï¼Œè·³è¿‡æ£€æŸ¥"
  exit 0
fi

# æ£€æŸ¥æ˜¯å¦ç¬¦åˆçº¦å®šå¼æäº¤æ ¼å¼ï¼ˆåªæ£€æŸ¥ç¬¬ä¸€è¡Œï¼‰
first_line=$(echo "$commit_msg" | head -n 1)
if ! echo "$first_line" | grep -qE "^(feat|fix|docs|test|chore|refactor|style|perf|ci|build)(\(.+\))?: .{1,}"; then
  echo "âŒ é”™è¯¯: æäº¤æ¶ˆæ¯æ ¼å¼ä¸ç¬¦åˆçº¦å®šå¼æäº¤è§„èŒƒ"
  echo ""
  echo "æ­£ç¡®æ ¼å¼ç¤ºä¾‹:"
  echo "  feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"
  echo "  fix(auth): ä¿®å¤éªŒè¯ç éªŒè¯é—®é¢˜"
  echo "  docs: æ›´æ–° README"
  echo "  test: æ·»åŠ  useAuth æµ‹è¯•ç”¨ä¾‹"
  echo ""
  echo "è¯·å‚è€ƒ: https://www.conventionalcommits.org/zh-hans/"
  exit 1
fi

echo "âœ… æäº¤æ¶ˆæ¯æ ¼å¼æ£€æŸ¥é€šè¿‡"
